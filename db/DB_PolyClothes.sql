CREATE DATABASE POLYCLOTHES
GO
USE POLYCLOTHES
GO
CREATE TABLE NHANVIEN(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenNV NVARCHAR(100),
    DiaChi NVARCHAR(150),
    Sdt VARCHAR(10),
    Email VARCHAR(50),
    GioiTinh BIT,
    TaiKhoan VARCHAR(50),
    MatKhau VARCHAR(20),
    VaiTro NVARCHAR(50),
    TrangThai BIT
)
GO
CREATE TABLE KHACHHANG(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenKH NVARCHAR(100),
    DiaChi NVARCHAR(150),
    Sdt VARCHAR(10),
    Email VARCHAR(50),
    GioiTinh BIT,
    TrangThai BIT
)
GO
CREATE TABLE SANPHAM(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_LoaiSP INT,
    ID_Mau INT,
    ID_Size INT,
    ID_CL INT,
	TenSP NVARCHAR(100),
    SoLuong INT,
    GiaSP MONEY,
    GiaSauSale MONEY,
    TrangThai BIT
)
GO
CREATE TABLE LOAISANPHAM(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenLoaiSP NVARCHAR(100),
    TrangThai BIT
)
GO
CREATE TABLE MAU(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenMau NVARCHAR(100),
    TrangThai BIT
)
GO
CREATE TABLE SIZE(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenSize NVARCHAR(100),
    TrangThai BIT
)
GO
CREATE TABLE CHATLIEU(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenCL NVARCHAR(100),
    TrangThai BIT
)
GO
CREATE TABLE SALE(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TenChienDich NVARCHAR(100),
    StartDate DATE,
    EndDate DATE,
    TrangThai BIT
)
GO
CREATE TABLE SALE_CT(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_Sale INT,
    ID_sp INT,
    GiaTriGiamGia INT,
    DonViGiam VARCHAR(10),
    TrangThai BIT
)
GO
CREATE TABLE HOADON(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_NV INT,
    ID_KH INT,
    TongTien MONEY,
    MaGiamGia VARCHAR(10),
    GhiChu NVARCHAR(150),
    HinhThucThanhToan NVARCHAR(50),
    TrangThai BIT
)
GO
CREATE TABLE HOADON_CT(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_SP INT,
    ID_HD INT,
    SoLuong INT,
    Gia MONEY,
    TongTien MONEY, 
    TrangThai BIT
)
GO
CREATE TABLE VOUCHER(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_NV INT,
    TenChienDich NVARCHAR(100),
    StartDate DATE,
    EndDate DATE,
    GiaTriGiam INT,
    DonViGiam VARCHAR(10),
    TrangThai BIT
)
GO
CREATE TABLE VOUCHER_CT(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_Voucher INT,
    ID_KH INT,
    ID_HD INT,
    MaVoucher AS LEFT(CONVERT(VARCHAR(250), NEWID()), 10),
    SoLuong INT,
    GiaTriGiam INT,
    DonViGiam VARCHAR(10),
    TrangThai BIT
)
GO
ALTER TABLE SANPHAM ADD CONSTRAINT fk_sp_loaisp FOREIGN KEY (ID_LoaiSP) REFERENCES LOAISANPHAM (ID);
ALTER TABLE SANPHAM ADD CONSTRAINT fk_sp_mau FOREIGN KEY (ID_Mau) REFERENCES MAU (ID);
ALTER TABLE SANPHAM ADD CONSTRAINT fk_sp_size FOREIGN KEY (ID_Size) REFERENCES SIZE (ID);
ALTER TABLE SANPHAM ADD CONSTRAINT fk_sp_chatlieu FOREIGN KEY (ID_CL) REFERENCES CHATLIEU (ID);
ALTER TABLE SALE_CT ADD CONSTRAINT fk_saleCT_sale FOREIGN KEY (ID_Sale) REFERENCES SALE (ID);
ALTER TABLE SALE_CT ADD CONSTRAINT fk_saleCT_sp FOREIGN KEY (ID_SP) REFERENCES SANPHAM (ID);
ALTER TABLE HOADON ADD CONSTRAINT fk_hoadon_nhanvien FOREIGN KEY (ID_NV) REFERENCES NHANVIEN (ID);
ALTER TABLE HOADON ADD CONSTRAINT fk_hoadon_khachhang FOREIGN KEY (ID_KH) REFERENCES KHACHHANG (ID);
ALTER TABLE HOADON_CT ADD CONSTRAINT fk_hdct_sp FOREIGN KEY (ID_SP) REFERENCES SANPHAM (ID);
ALTER TABLE HOADON_CT ADD CONSTRAINT fk_hdct_hoadon FOREIGN KEY (ID_HD) REFERENCES HOADON (ID);
ALTER TABLE VOUCHER ADD CONSTRAINT fk_voucher_nhanvien FOREIGN KEY (ID_NV) REFERENCES NHANVIEN (ID);
ALTER TABLE VOUCHER_CT ADD CONSTRAINT fk_voucherCT_voucher FOREIGN KEY (ID_Voucher) REFERENCES VOUCHER (ID);
ALTER TABLE VOUCHER_CT ADD CONSTRAINT fk_voucherCT_khachhang FOREIGN KEY (ID_KH) REFERENCES KHACHHANG (ID);
ALTER TABLE VOUCHER_CT ADD CONSTRAINT fk_voucherCT_hoadon FOREIGN KEY (ID_HD) REFERENCES HOADON (ID);

